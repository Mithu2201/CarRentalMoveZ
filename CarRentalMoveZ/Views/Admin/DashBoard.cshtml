@model CarRentalMoveZ.DTOs.DashboardDTO


@{
    ViewData["Title"] = "Dashboard";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}



<!-- KPI Cards Row -->
<div class="row g-3 mb-3">
    <!-- Card 1 -->
    <div class="col-12 col-md-3">
        <div class="card p-3 kpi">
            <h6>Total Bookings</h6>
            <div class="d-flex align-items-center justify-content-between">
                <h3>@Model.TotalBookings</h3>
               @*  <span class="chip-up"><i class="bi bi-arrow-up-right"></i> 11.2%</span> *@
            </div>
            <div class="muted small">summary</div>
        </div>
        <!-- Buttons under Card 1 -->
        <div class="d-flex gap-2 mt-2">
            <a asp-controller="Admin" asp-action="AddCar" class="btn btn-theme btn-sm w-50 py-2">
                Add Car
            </a>
            <a asp-controller="Admin" asp-action="AddDriver" class="btn btn-theme btn-sm w-50 py-2">
                Add Driver
            </a>
        </div>

    </div>

    <!-- Card 2 -->
    <div class="col-12 col-md-3">
        <div class="card p-3 kpi">
            <h6>Total Revenue</h6>
            <div class="d-flex align-items-center justify-content-between">
                <h3>@Model.TotalRevenue.ToString("C", System.Globalization.CultureInfo.CreateSpecificCulture("en-LK"))</h3>
               @*  <span class="chip-up"><i class="bi bi-arrow-up-right"></i> 12.6%</span> *@
            </div>
            <div class="muted small">summary</div>
        </div>
        <!-- Buttons under Card 2 -->
        <div class="d-flex gap-2 mt-2">
            <a asp-controller="Admin" asp-action="AddOffer" class="btn btn-theme btn-sm w-50 py-2">Add Offer</a>
            <a asp-controller="Admin" asp-action="AddStaff" class="btn btn-theme btn-sm w-50 py-2">Add Staff</a>
        </div>
    </div>

    <!-- Card 3 -->
    <div class="col-12 col-md-3">
        <div class="card p-3 kpi">
            <h6>Available Cars / Total Cars</h6>
            <div class="d-flex align-items-center justify-content-between">
                <h3>@Model.AvailableCars / @Model.TotalCars</h3>
               @*  <span class="chip-dn"><i class="bi bi-arrow-down-right"></i> 2.8%</span> *@
            </div>
            <div class="muted small">summary</div>
        </div>
        <!-- Buttons under Card 3 -->
        <div class="d-flex gap-2 mt-2">
            <a asp-controller="Admin" asp-action="ManageBookings" class="btn btn-theme btn-sm w-50 py-2">Bookings</a>
            <a asp-controller="Admin" asp-action="ManageCar" class="btn btn-theme btn-sm w-50 py-2">Cars</a>
        </div>
    </div>

    <!-- Card 4 -->
    <div class="col-12 col-md-3">
        <div class="card p-3 kpi">
            <h6>Total Customers</h6>
            <div class="d-flex align-items-center justify-content-between">
                <h3>@Model.TotalCustomers</h3>
                @* <span class="chip-up"><i class="bi bi-arrow-up-right"></i> 3.4%</span> *@
            </div>
            <div class="muted small">summary</div>
        </div>
        <!-- Buttons under Card 4 -->
        <div class="d-flex gap-2 mt-2">
            <a asp-controller="Admin" asp-action="ManageCustomer" class="btn btn-theme btn-sm w-50 py-2">Customers</a>
            <a asp-controller="Admin" asp-action="Cashier" class="btn btn-theme btn-sm w-50 py-2">Cashier</a>
        </div>
    </div>

</div>

<div class="row g-3">
    <!-- Earnings Summary: takes 65% -->
    <div class="col-md-7">
        <div class="card p-3 h-100">
            <div class="fw-semibold mb-2">Earnings Summary</div>
            <div style="height:300px;">
                <canvas id="earningsChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Rent Status Pie Chart -->
    <div class="col-md-3">
        <div class="card p-3 h-100">
            <div class="fw-semibold mb-2">Rent Status <span class="small text-muted">(This Week)</span></div>
            <div style="height:230px;">
                <canvas id="rentStatusChart"></canvas>
            </div>
            <div class="mt-2 small">
                @{
                    var total = Model.BookedCount + Model.PendingCount + Model.CancelledCount;
                    var bookedPercent = total > 0 ? (Model.BookedCount * 100 / total) : 0;
                    var pendingPercent = total > 0 ? (Model.PendingCount * 100 / total) : 0;
                    var cancelledPercent = total > 0 ? (Model.CancelledCount * 100 / total) : 0;
                }
                <div class="d-flex justify-content-between"><span>Assigned</span><span>@bookedPercent%</span></div>
                <div class="d-flex justify-content-between"><span>Pending</span><span>@pendingPercent%</span></div>
                <div class="d-flex justify-content-between"><span>Cancelled</span><span>@cancelledPercent%</span></div>
            </div>
        </div>
    </div>

    <!-- Car Status Pie Chart -->
    <div class="col-md-2">
        <div class="card p-3 h-100">
            <div class="fw-semibold mb-2">Car Status Overview</div>
            <div style="height:230px;">
                <canvas id="carStatusChart"></canvas>
            </div>
            <div class="mt-2 small">
                @{
                    var totalCars = Model.AvailableCarCount + Model.BookedCarCount + Model.PendingCarCount;
                    var availablePercent = totalCars > 0 ? (Model.AvailableCarCount * 100 / totalCars) : 0;
                    var bookedPercentCar = totalCars > 0 ? (Model.BookedCarCount * 100 / totalCars) : 0;
                    var pendingPercentCar = totalCars > 0 ? (Model.PendingCarCount * 100 / totalCars) : 0;
                }
                <div class="d-flex justify-content-between"><span>Available</span><span>@availablePercent%</span></div>
                <div class="d-flex justify-content-between"><span>Booked</span><span>@bookedPercentCar%</span></div>
                <div class="d-flex justify-content-between"><span>Pending</span><span>@pendingPercentCar%</span></div>
            </div>
        </div>
    </div>
</div>


<div class="row g-3 mt-3">
    <div class="col-12">
        <div class="card p-3">
            <div class="fw-semibold mb-2">Hourly Booking Overview (Today)</div>
            <div style="height:300px;">
                <canvas id="hourlyBookingChart"></canvas>
            </div>
        </div>
    </div>
</div>



@section Scripts {
    <script>
        /* Line: Earnings */
        new Chart(document.getElementById('earningsChart'), {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.EarningsHours)), // ⬅️ now hourly labels
                datasets: [{
                    label: "Revenue",
                    data: @Html.Raw(Json.Serialize(Model.EarningsRevenue)), // ⬅️ now hourly revenue
                    borderColor: "#1E56A0",
                    backgroundColor: "rgba(30,86,160,.12)",
                    fill: true,
                    tension: .4,
                    pointRadius: 3
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { grid: { color: "rgba(0,0,0,.05)" } },
                    x: { grid: { display: false } }
                }
            }
        });


        /* Doughnut: Rent Status */
        new Chart(document.getElementById('rentStatusChart'), {
            type: 'doughnut',
            data: {
                labels: ["Assigned","Pending","Cancelled"],
                datasets: [{
                    data: [@Model.BookedCount, @Model.PendingCount, @Model.CancelledCount], // dynamically from DB
                    backgroundColor: ["#1E56A0","#f59f00","#6c757d"]
                }]
            },
            options: {
                maintainAspectRatio: false,
                cutout: "65%",
                plugins: { legend: { position: "bottom" } }
            }
        });

        /* Hourly Booking Overview */
        new Chart(document.getElementById('hourlyBookingChart'), {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.BookingHours)),    // "09:00", "10:00", ...
                datasets: [{
                    label: "Bookings",
                    data: @Html.Raw(Json.Serialize(Model.BookingCounts)), // counts per hour
                    backgroundColor: "#1E56A0"
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: "rgba(0,0,0,.05)" } },
                    x: { grid: { display: false } }
                }
            }
        });

                /* Car Status Pie Chart */
        new Chart(document.getElementById('carStatusChart'), {
            type: 'doughnut',
            data: {
                labels: ["Available", "Booked", "Pending"],
                datasets: [{
                    data: [@Model.AvailableCarCount, @Model.BookedCarCount, @Model.PendingCarCount],
                    backgroundColor: ["#28a745", "#1E56A0", "#f59f00"]
                }]
            },
            options: {
                maintainAspectRatio: false,
                cutout: "65%",
                plugins: { legend: { position: "bottom" } }
            }
        });



    </script>

}
