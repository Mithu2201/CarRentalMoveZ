@model IEnumerable<CarRentalMoveZ.DTOs.DriverDTO>

@{
    ViewData["Title"] = "Manage Drivers";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid py-3">
    <!-- Header -->
    <div class="d-flex align-items-center justify-content-between flex-wrap mb-4">
        <h3>Driver Management</h3>
        <div class="d-flex gap-2 flex-grow-1 justify-content-end flex-wrap mb-2">

            <!-- Search -->
            <div class="input-group" style="max-width: 250px; flex-grow: 1;">
                <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                <input type="text" id="searchInput" class="form-control" placeholder="Search name, email..." />
            </div>

            <!-- Status Filter -->
            <select id="statusFilter" class="form-select" style="max-width: 150px;">
                <option value="">All Status</option>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
                <option value="Suspended">Suspended</option>
            </select>

            <!-- Add Button -->
            <a class="btn btn-theme d-flex align-items-center" style="height: 38px;" asp-action="AddDriver">
                <i class="bi bi-plus me-2"></i> Add New Driver
            </a>
        </div>
    </div>

    <!-- Driver Table -->
    <div class="table-responsive shadow-sm rounded-4 mt-3">
        <table class="table table-hover align-middle mb-0" id="driverTable">
            <thead class="cashier-thead">
                <tr>
                    <th>Driver ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody class="small">
                @if (Model != null && Model.Any())
                {
                    foreach (var driver in Model)
                    {
                        string badgeClass = driver.Status switch
                        {
                            "Active" => "pill-available",
                            "On Duty" => "pill-pending",
                            "Suspended" => "pill-cancelled",
                            _ => "pill-default"
                        };

                        <tr>
                            <td>@driver.DriverId</td>
                            <td>@driver.Name</td>
                            <td>@driver.Email</td>
                            <td>@driver.PhoneNumber</td>
                            <td>
                                <span class="pill @badgeClass">@driver.Status</span>
                            </td>
                            <td class="text-center">
                                <a asp-action="EditDriver" asp-route-id="@driver.DriverId" class="btn btn-sm btn-theme-warning me-1">
                                    <i class="bi bi-pencil"></i> Edit
                                </a>
                                <a asp-controller="Admin" asp-action="DriverDetails" asp-route-id="@driver.DriverId" class="btn btn-sm btn-theme me-1">
                                    <i class="bi bi-eye"></i> View
                                </a>
                                <button type="button"
                                        class="btn btn-sm btn-theme-danger"
                                        data-bs-toggle="modal"
                                        data-bs-target="#deleteModal"
                                        data-id="@driver.DriverId"
                                        data-name="@driver.Name">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" class="text-center text-muted">No drivers found.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete <b id="driverName"></b>?
                </div>
                <div class="modal-footer">
                    <form id="deleteForm" method="post">
                        <input type="hidden" name="id" id="driverId" />
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        <button type="submit" class="btn btn-theme-danger">Yes, Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Delete modal
        var deleteModal = document.getElementById('deleteModal');
        deleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var driverId = button.getAttribute('data-id');
            var driverName = button.getAttribute('data-name');

            document.getElementById('driverName').textContent = driverName;
            document.getElementById('driverId').value = driverId;
            document.getElementById('deleteForm').action = '/Driver/Delete';
        });

        // Search & Filter
        document.getElementById("searchInput").addEventListener("input", filterTable);
        document.getElementById("statusFilter").addEventListener("change", filterTable);

        function filterTable() {
            const searchValue = document.getElementById("searchInput").value.toLowerCase();
            const statusValue = document.getElementById("statusFilter").value;

            document.querySelectorAll("#driverTable tbody tr").forEach(row => {
                const name = row.cells[1].innerText.toLowerCase();
                const email = row.cells[2].innerText.toLowerCase();
                const status = row.cells[4].innerText;

                const matchesSearch = name.includes(searchValue) || email.includes(searchValue);
                const matchesStatus = !statusValue || status === statusValue;

                row.style.display = (matchesSearch && matchesStatus) ? "" : "none";
            });
        }
    </script>
}
