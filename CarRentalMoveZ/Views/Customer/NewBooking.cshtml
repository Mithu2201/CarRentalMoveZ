@model CarRentalMoveZ.ViewModels.BookingViewModel

@{
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
    ViewData["Title"] = "New Booking";
}

<h2>Booking for @Model.CarName</h2>

<div class="row">
    <div class="col-md-6">
        <img src="@Model.ImgURL" class="img-fluid rounded" />
        <p><strong>Price Per Day:</strong> $@Model.PricePerDay</p>
    </div>

    <div class="col-md-6">
        <form asp-action="NewBooking" asp-controller="Customer" method="post">
            @* Hidden fields for binding *@
            <input type="hidden" asp-for="CarId" />
            <input type="hidden" asp-for="CustomerId" />
            <input type="hidden" asp-for="CarName" />
            <input type="hidden" asp-for="ImgURL" />
            <input type="hidden" asp-for="PricePerDay" />
            <input type="hidden" asp-for="CustomerName" />
            <input type="hidden" asp-for="PhoneNumber" />
            <input type="hidden" asp-for="Days" id="days" />
            <input type="hidden" asp-for="Amount" id="amount" />

            <div class="mb-3">
                <label>Customer</label>
                <input class="form-control" value="@Model.CustomerName" readonly />
            </div>

            <div class="mb-3">
                <label>Contact No</label>
                <input class="form-control" value="@Model.PhoneNumber" readonly />
            </div>

            <div class="mb-3">
                <label asp-for="Location">Pick Up Location</label>
                <input asp-for="Location" class="form-control" required />
            </div>

            <div class="mb-3">
                <label asp-for="StartDate">Start Date</label>
                <input asp-for="StartDate" type="date" class="form-control" id="startDate" required />
            </div>

            <div class="mb-3">
                <label asp-for="EndDate">End Date</label>
                <input asp-for="EndDate" type="date" class="form-control" id="endDate" required />
            </div>

            <div class="mb-3">
                <label>Number of Days</label>
                <input type="text" id="daysDisplay" class="form-control" readonly />
            </div>

            <div class="mb-3">
                <label>Total Amount</label>
                <input type="text" id="amountDisplay" class="form-control" readonly />
            </div>

            <button type="submit" class="btn btn-success w-100">Confirm Booking</button>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function calculateBooking() {
            const start = document.getElementById("startDate").value;
            const end = document.getElementById("endDate").value;
            const price = parseFloat("@Model.PricePerDay");

            if (start && end) {
                const startDate = new Date(start);
                const endDate = new Date(end);

                if (endDate >= startDate) {
                    const diffTime = endDate - startDate;
                    const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // inclusive
                    const amount = days * price;

                    document.getElementById("daysDisplay").value = days;
                    document.getElementById("amountDisplay").value = "$" + amount.toFixed(2);

                    document.getElementById("days").value = days;
                    document.getElementById("amount").value = amount.toFixed(2);
                } else {
                    document.getElementById("daysDisplay").value = "";
                    document.getElementById("amountDisplay").value = "";
                    document.getElementById("days").value = "";
                    document.getElementById("amount").value = "";
                }
            }
        }

        document.getElementById("startDate").addEventListener("change", calculateBooking);
        document.getElementById("endDate").addEventListener("change", calculateBooking);

        calculateBooking(); // Recalculate on page load if values are pre-filled
    </script>
}
